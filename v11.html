<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>UV Index - 5 Day Hourly Forecast</title>
<style>
body {
  font-family: system-ui, -apple-system, Segoe UI, Roboto;
  background: #f6f8fa;
  margin: 0;
  padding: 20px;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.card {
  background: white;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 6px 24px rgba(0,0,0,0.08);
  width: 100%;
  max-width: 420px;
  margin-bottom: 20px;
}

.small { color: #666; font-size: 14px; }

input { width: 100%; padding: 8px; border-radius: 8px; border: 1px solid #ddd; margin-top: 8px; }
.btn { margin-top: 8px; padding: 8px 12px; border-radius: 8px; border: 0; background: #0b74de; color: white; cursor: pointer; transition: 0.2s; }
.btn:hover { background: #095bb5; }

.day-buttons { display: flex; gap: 8px; margin: 12px 0; flex-wrap: wrap; justify-content: center; }
.day-buttons button { flex: 1; min-width: 60px; padding: 6px; font-size: 14px; }

.uv-circle { position: relative; width: 120px; height: 120px; border-radius: 50%; margin: 20px auto; }
.uv-circle svg { transform: rotate(-90deg); }
.uv-circle circle.bg { fill:none; stroke:#ddd; stroke-width:12; }
.uv-circle circle.fg { fill:none; stroke-width:12; stroke-linecap:round; stroke-dasharray: 339.292; stroke-dashoffset: 339.292; transition: stroke-dashoffset 1s ease, stroke 1s ease; }
.uv-value { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-size:32px; font-weight:bold; }

.hourly-container { width:100%; max-width:420px; margin-top: 20px; }
.hourly-bar-container {
  display:flex;
  justify-content: space-between;
  align-items:flex-end;
  height:140px;
  margin-bottom:4px;
  position: relative;
}
.hourly-bar { width:3%; display:flex; flex-direction: column; justify-content:flex-end; align-items:center; }
.hourly-bar div { width: 100%; border-radius:4px 4px 0 0; }
.hour-labels { display:flex; justify-content: space-between; font-size:10px; margin-top:2px; }

.sun-line { position:absolute; top:-20px; left:0; width:100%; display:flex; justify-content:space-between; align-items:center; pointer-events:none; }
.sun-line .line { flex:1; height:4px; background: #ffcc00; border-radius:2px; margin:0 4px; }
.sun-icon { font-size:16px; color:#ffcc00; }

.uv-table-container { width:100%; max-width:420px; margin-top:30px; display:flex; justify-content: space-between; }
.uv-circle-scale { display:flex; gap:8px; justify-content: space-between; }
.uv-scale-circle { width:50px; height:50px; border-radius:50%; display:flex; align-items:center; justify-content:center; color:white; font-size:12px; font-weight:bold; text-align:center; flex-direction:column; }
</style>
</head>
<body>

<div class="card">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <div>
      <div class="small">Current UV Index</div>
      <div class="uv-circle">
        <svg width="120" height="120">
          <circle class="bg" r="54" cx="60" cy="60"></circle>
          <circle class="fg" r="54" cx="60" cy="60"></circle>
        </svg>
        <div class="uv-value" id="uv">--</div>
      </div>
      <div id="desc" class="small">Waiting for data</div>
    </div>
    <div style="text-align:right">
      <div class="small">Location:</div>
      <div id="coords" class="small">—</div>
    </div>
  </div>

  <hr style="margin:14px 0">

  <div class="small">Enter coordinates (lat,lon) or use location:</div>
  <input id="manual" placeholder="e.g., 39.92,32.85 or leave empty" />
  <div style="display:flex;gap:8px;margin-top:8px">
    <button class="btn" id="geo">Use My Location</button>
    <button class="btn" id="check">Fetch UV</button>
  </div>

  <div class="day-buttons" id="day-buttons"></div>
</div>

<div class="hourly-container">
  <div class="hourly-bar-container" id="hourly-bars"></div>
  <div class="sun-line" id="sun-line"></div>
  <div class="hour-labels" id="hour-labels"></div>
</div>

<h3 style="text-align:center; margin-top:30px">UV Index Reference</h3>
<div class="uv-table-container">
  <div class="uv-circle-scale">
    <div class="uv-scale-circle" style="background:#a8e05f; color:black;">0-2<br>Low</div>
    <div class="uv-scale-circle" style="background:#fdd835; color:black;">3-5<br>Moderate</div>
    <div class="uv-scale-circle" style="background:#f97306;">6-7<br>High</div>
    <div class="uv-scale-circle" style="background:#ef4444;">8-10<br>Very High</div>
    <div class="uv-scale-circle" style="background:#9b30ff;">11+<br>Extreme</div>
  </div>
</div>

<script>
const uvEl = document.getElementById('uv');
const descEl = document.getElementById('desc');
const coordsEl = document.getElementById('coords');
const manual = document.getElementById('manual');
const fgCircle = document.querySelector('.fg');
const hourlyBars = document.getElementById('hourly-bars');
const hourLabels = document.getElementById('hour-labels');
const dayButtons = document.getElementById('day-buttons');
const sunLine = document.getElementById('sun-line');

function uvCategory(val){
  if(val===null||val===undefined) return 'Unknown';
  if(val<3) return 'Low';
  if(val<6) return 'Moderate';
  if(val<8) return 'High';
  if(val<11) return 'Very High';
  return 'Extreme';
}
function uvColor(val){
  if(val<3) return '#a8e05f';
  if(val<6) return '#fdd835';
  if(val<8) return '#f97306';
  if(val<11) return '#ef4444';
  return '#9b30ff';
}

let fiveDays = [];

async function fetchUV(lat, lon){
  uvEl.textContent='...';
  descEl.textContent='Fetching data';
  coordsEl.textContent=`${lat.toFixed(5)}, ${lon.toFixed(5)}`;

  try{
    const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&hourly=uv_index&daily=sunrise,sunset&timezone=UTC`);
    if(!res.ok) throw new Error('API error: '+res.status);
    const data = await res.json();

    // Prepare 5-day buttons
    fiveDays = data.daily.time.map((d,i)=>({
      date:d,
      sunrise:data.daily.sunrise[i],
      sunset:data.daily.sunset[i],
      hours:data.hourly.time.filter(t=>t.startsWith(d)),
      uv:data.hourly.uv_index.filter((v,j)=>data.hourly.time[j].startsWith(d))
    }));

    renderDayButtons();

    selectDay(0); // default today

  }catch(err){
    uvEl.textContent='Error';
    descEl.textContent=err.message;
  }
}

function renderDayButtons(){
  dayButtons.innerHTML='';
  fiveDays.forEach((day,i)=>{
    const btn = document.createElement('button');
    const dateObj = new Date(day.date+'T00:00:00Z');
    btn.textContent = dateObj.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day:'numeric' });
    btn.onclick = () => selectDay(i);
    dayButtons.appendChild(btn);
  });
}

function selectDay(index){
  const day = fiveDays[index];
  const now = new Date();
  const hours = day.hours.map(t=>new Date(t+'Z'));
  const uvs = day.uv;

  uvEl.textContent = uvs[0]?.toFixed(1) || '--';
  descEl.textContent = uvCategory(uvs[0]) + ` • Sunrise: ${day.sunrise.slice(11,16)} UTC, Sunset: ${day.sunset.slice(11,16)} UTC`;

  animateUVCircle(uvs[0]);
  renderHourlyBars(hours, uvs, day.sunrise, day.sunset);
}

function animateUVCircle(uvVal){
  const maxVal = 11;
  const percent = Math.min(uvVal/maxVal,1);
  const dashOffset = 339.292*(1-percent);
  fgCircle.style.strokeDashoffset=dashOffset;
  fgCircle.style.stroke=uvColor(uvVal);
}

function renderHourlyBars(hours, uvs, sunrise, sunset){
  hourlyBars.innerHTML='';
  hourLabels.innerHTML='';
  sunLine.innerHTML='';

  const sunriseDate = new Date(sunrise+'Z');
  const sunsetDate = new Date(sunset+'Z');

  hours.forEach((hourDate,i)=>{
    const uv = uvs[i] ?? 0;
    const color = uvColor(uv);
    const heightPercent = Math.min((uv/11)*100,100);
    const bar = document.createElement('div');
    bar.className='hourly-bar';
    bar.innerHTML=`<div style="background:${color}; height:${heightPercent}%"></div>`;
    hourlyBars.appendChild(bar);

    const label = document.createElement('div');
    label.textContent = hourDate.getUTCHours();
    hourLabels.appendChild(label);
  });

  // Sun line
  const total = hours.length;
  const startIndex = hours.findIndex(h=>h>=sunriseDate);
  const endIndex = hours.findIndex(h=>h>=sunsetDate);
  if(startIndex>=0 && endIndex>=0){
    const sunStart = document.createElement('div');
    sunStart.className='sun-icon';
    sunStart.textContent='☀️';
    sunLine.appendChild(sunStart);

    const lineDiv = document.createElement('div');
    lineDiv.className='line';
    lineDiv.style.flex = endIndex-startIndex;
    sunLine.appendChild(lineDiv);

    const sunEnd = document.createElement('div');
    sunEnd.className='sun-icon';
    sunEnd.textContent='🌇';
    sunLine.appendChild(sunEnd);
  }
}

document.getElementById('geo').onclick = () => {
  if(!navigator.geolocation) return alert('Browser does not support geolocation API');
  navigator.geolocation.getCurrentPosition(p=>{
    manual.value = p.coords.latitude.toFixed(5)+','+p.coords.longitude.toFixed(5);
    fetchUV(p.coords.latitude,p.coords.longitude);
  }, e => alert('Could not get location: '+e.message));
};

document.getElementById('check').onclick = () => {
  const text = manual.value.trim();
  if(!text) return alert('Please enter lat,lon or use Get Location.');
  const parts = text.split(',').map(s=>s.trim());
  if(parts.length<2) return alert('Format: lat,lon (e.g., 39.92,32.85)');
  const lat=parseFloat(parts[0]), lon=parseFloat(parts[1]);
  if(isNaN(lat)||isNaN(lon)) return alert('Invalid coordinates');
  fetchUV(lat, lon);
};

manual.value='41.00824,28.97836';
fetchUV(41.00824,28.97836);
</script>
</body>
</html>
